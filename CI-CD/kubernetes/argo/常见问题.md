# 常见问题

## workflow 默认使用 root 账号？

workflow 的流程默认使用 root 账号，如果你的镜像默认使用非 root 账号，而且要修改文件，就很可能遇到 Permission Denined 的问题。

解决方法：通过 Pod Security Context 手动设定容器的 user/group:

- [Workflow Pod Security Context](https://argoproj.github.io/argo/workflow-pod-security-context/)


安全起见，我建议所有的 workflow 都手动设定 `securityContext`，示例：

```yaml
apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: xxx
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
```

或者也可以通过 `workflow-controller-configmap` 的 `workflowDefaults` 设定默认的 workflow 配置。

## 如何从 hashicorp vault 中读取 secrets?

>参考 [Support to get secrets from Vault](https://github.com/argoproj/argo/issues/3267#issuecomment-650119636)

hashicorp vault 目前可以说是云原生领域最受欢迎的 secrets 管理工具。
我们在生产环境用它做为分布式配置中心，同时在本地 CI/CD 中，也使用它存储相关的敏感信息。

现在迁移到 argo，我们当然希望能够有一个好的方法从 vault 中读取配置。

目前最推荐的方法，是使用 vault 的 vault-agent，将 secrets 以文件的形式注入到 pod 中。

通过 valut-policy - vault-role - k8s-serviceaccount 一系列认证授权配置，可以制定非常细粒度的 secrets 权限规则，而且配置信息阅后即焚，安全性很高。


## Argo 对 CR 资源的验证不够严谨，写错了 key 都不报错

待研究

